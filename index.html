<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista de Pre√ßos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom styles for print/share */
      @media print {
        .no-print {
          display: none !important;
        }
        .print-only {
          display: block !important;
        }
      }

      .report-preview {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 0.5rem;
      }

      @media (max-width: 640px) {
        .product-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-4xl mx-auto px-4 py-4">
        <h1 class="text-2xl font-bold text-gray-900">Lista de Pre√ßos</h1>
        <p class="text-gray-600 text-sm mt-1">Preencha os pre√ßos e gere seu relat√≥rio</p>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-6">
      <!-- Form Section -->
      <section id="form-section" class="space-y-6">
        <!-- Report Title -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <label for="report-title" class="block text-sm font-medium text-gray-700 mb-2"> T√≠tulo do Relat√≥rio </label>
          <input
            type="text"
            id="report-title"
            placeholder="Digite o t√≠tulo do relat√≥rio"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
          />
        </div>

        <!-- Products List -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-4">Produtos</h2>
          <div id="products-container" class="space-y-3">
            <!-- Products will be dynamically generated here -->
          </div>
        </div>

        <!-- Actions -->
        <div class="flex flex-col sm:flex-row gap-3">
          <button
            id="generate-report-btn"
            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
          >
            Gerar Relat√≥rio
          </button>
          <button
            id="clear-all-btn"
            class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-6 rounded-lg transition-colors focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
          >
            Limpar Tudo
          </button>
        </div>
      </section>

      <!-- Report Preview Section -->
      <section id="report-section" class="hidden">
        <!-- Report Content -->
        <div id="report-content" class="report-preview rounded-lg p-6 text-white">
          <div class="text-center mb-6">
            <h2 id="report-title-display" class="text-2xl font-bold mb-2"></h2>
            <p class="text-blue-100" id="report-date"></p>
          </div>

          <div id="report-products" class="product-grid">
            <!-- Report products will be generated here -->
          </div>
        </div>

        <!-- Report Actions -->
        <div class="flex flex-col sm:flex-row gap-3 mt-6">
          <button
            id="share-btn"
            class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-colors focus:ring-2 focus:ring-green-500 focus:ring-offset-2"
          >
            üì§ Compartilhar
          </button>
          <button
            id="back-btn"
            class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-6 rounded-lg transition-colors focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
          >
            ‚Üê Voltar
          </button>
        </div>
      </section>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
        <span class="text-gray-700">Processando...</span>
      </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/report.js"></script>
    <script src="js/share.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>

<!-- js/config.js -->
<script id="config-js" type="text/plain">
  /**
   * Configuration constants and product data
   */
  const CONFIG = {
      STORAGE_KEY: 'price-list-data',
      APP_NAME: 'Lista de Pre√ßos',
      VERSION: '1.0.0'
  };

  const PRODUCTS = [
      'Cebola CX 3',
      'Cebola CX 2',
      'Cebola VC 1',
      'Cebola fraca',
      'Cebola roxa',
      'Batata lavada',
      'Batata escovada',
      'Batata m√©dia',
      'Batata para rechear',
      'Batata roxa',
      'Batata para fritura',
      'Batata palha',
      'Batata chips',
      'Alho CX 10kg',
      'Ovos embalados',
      'Ovos bandeja',
      'Feij√£o preto',
      'Feij√£o vermelho',
      'Cenoura',
      'Cenoura G',
      'Beterraba G',
      'Beterraba boa',
      'Beterraba mi√∫da',
      'Ab√≥bora seca',
      'Batata-doce G',
      'Batata-doce boa',
      'Batata-doce P',
      'Tomate G',
      'Tomate m√©dio',
      'Tomate Saladette',
      'Tomate cereja',
      'Pepino',
      'Vagem',
      'Ab√≥bora verde',
      'Pepino japon√™s',
      'Chuchu',
      'Alface crespa',
      'Alface americana',
      'R√∫cula',
      'Agri√£o',
      'Cebolinha',
      'Salsa',
      'Repolho verde',
      'Repolho roxo',
      'Couve-flor',
      'Br√≥colis',
      'Manga',
      'Lim√£o',
      'Laranja',
      'Mel√£o',
      'Abacaxi',
      'Gengibre'
  ];
</script>

<!-- js/storage.js -->
<script id="storage-js" type="text/plain">
  /**
   * Local Storage management
   */
  class StorageManager {
      constructor() {
          this.storageKey = CONFIG.STORAGE_KEY;
      }

      /**
       * Save data to localStorage
       * @param {Object} data - Data to save
       */
      save(data) {
          try {
              const dataToSave = {
                  ...data,
                  lastUpdated: new Date().toISOString()
              };
              localStorage.setItem(this.storageKey, JSON.stringify(dataToSave));
              return true;
          } catch (error) {
              console.error('Error saving to localStorage:', error);
              return false;
          }
      }

      /**
       * Load data from localStorage
       * @returns {Object|null} Loaded data or null if not found
       */
      load() {
          try {
              const data = localStorage.getItem(this.storageKey);
              return data ? JSON.parse(data) : null;
          } catch (error) {
              console.error('Error loading from localStorage:', error);
              return null;
          }
      }

      /**
       * Clear all stored data
       */
      clear() {
          try {
              localStorage.removeItem(this.storageKey);
              return true;
          } catch (error) {
              console.error('Error clearing localStorage:', error);
              return false;
          }
      }

      /**
       * Save current form data
       */
      saveCurrentData() {
          const title = document.getElementById('report-title').value;
          const prices = {};

          PRODUCTS.forEach(product => {
              const input = document.getElementById(`price-${this.getProductId(product)}`);
              if (input && input.value) {
                  prices[product] = input.value;
              }
          });

          return this.save({ title, prices });
      }

      /**
       * Load and populate form data
       */
      loadAndPopulateData() {
          const data = this.load();
          if (!data) return;

          // Load title
          if (data.title) {
              document.getElementById('report-title').value = data.title;
          }

          // Load prices
          if (data.prices) {
              Object.entries(data.prices).forEach(([product, price]) => {
                  const input = document.getElementById(`price-${this.getProductId(product)}`);
                  if (input) {
                      input.value = price;
                  }
              });
          }
      }

      /**
       * Generate product ID for form elements
       * @param {string} product - Product name
       * @returns {string} Product ID
       */
      getProductId(product) {
          return product.toLowerCase()
              .replace(/\s+/g, '-')
              .replace(/[^\w-]/g, '');
      }
  }
</script>

<!-- js/ui.js -->
<script id="ui-js" type="text/plain">
  /**
   * UI Management and DOM manipulation
   */
  class UIManager {
      constructor() {
          this.formSection = document.getElementById('form-section');
          this.reportSection = document.getElementById('report-section');
          this.loadingOverlay = document.getElementById('loading-overlay');
          this.storage = new StorageManager();
      }

      /**
       * Initialize UI components
       */
      init() {
          this.renderProductList();
          this.setupEventListeners();
          this.storage.loadAndPopulateData();
      }

      /**
       * Render the product list
       */
      renderProductList() {
          const container = document.getElementById('products-container');

          PRODUCTS.forEach(product => {
              const productElement = this.createProductElement(product);
              container.appendChild(productElement);
          });
      }

      /**
       * Create a product input element
       * @param {string} product - Product name
       * @returns {HTMLElement} Product element
       */
      createProductElement(product) {
          const productId = this.storage.getProductId(product);

          const div = document.createElement('div');
          div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200';

          div.innerHTML = `
              <label for="price-${productId}" class="flex-1 text-sm font-medium text-gray-700 pr-3">
                  ${product}
              </label>
              <div class="flex items-center">
                  <span class="text-gray-500 text-sm mr-2">R$</span>
                  <input
                      type="number"
                      id="price-${productId}"
                      step="0.01"
                      min="0"
                      placeholder="0,00"
                      class="w-24 px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
              </div>
          `;

          return div;
      }

      /**
       * Setup event listeners
       */
      setupEventListeners() {
          // Generate Report Button
          document.getElementById('generate-report-btn').addEventListener('click', () => {
              this.generateReport();
          });

          // Clear All Button
          document.getElementById('clear-all-btn').addEventListener('click', () => {
              this.clearAllFields();
          });

          // Back Button
          document.getElementById('back-btn').addEventListener('click', () => {
              this.showFormSection();
          });

          // Auto-save on input change
          document.addEventListener('input', (e) => {
              if (e.target.type === 'number' || e.target.id === 'report-title') {
                  this.debounce(() => {
                      this.storage.saveCurrentData();
                  }, 1000)();
              }
          });
      }

      /**
       * Generate and show report
       */
      async generateReport() {
          this.showLoading(true);

          // Save current data
          this.storage.saveCurrentData();

          // Simulate processing time
          await this.delay(800);

          // Generate report
          const reportManager = new ReportManager();
          const success = reportManager.generateReport();

          this.showLoading(false);

          if (success) {
              this.showReportSection();
          } else {
              this.showAlert('Erro ao gerar relat√≥rio. Verifique se h√° pelo menos um pre√ßo preenchido.');
          }
      }

      /**
       * Clear all form fields
       */
      clearAllFields() {
          if (confirm('Tem certeza que deseja limpar todos os campos?')) {
              document.getElementById('report-title').value = '';

              PRODUCTS.forEach(product => {
                  const input = document.getElementById(`price-${this.storage.getProductId(product)}`);
                  if (input) input.value = '';
              });

              this.storage.clear();
          }
      }

      /**
       * Show form section
       */
      showFormSection() {
          this.formSection.classList.remove('hidden');
          this.reportSection.classList.add('hidden');
      }

      /**
       * Show report section
       */
      showReportSection() {
          this.formSection.classList.add('hidden');
          this.reportSection.classList.remove('hidden');
      }

      /**
       * Show/hide loading overlay
       * @param {boolean} show - Whether to show loading
       */
      showLoading(show) {
          if (show) {
              this.loadingOverlay.classList.remove('hidden');
          } else {
              this.loadingOverlay.classList.add('hidden');
          }
      }

      /**
       * Show alert message
       * @param {string} message - Message to show
       */
      showAlert(message) {
          alert(message);
      }

      /**
       * Debounce function
       * @param {Function} func - Function to debounce
       * @param {number} wait - Wait time in ms
       * @returns {Function} Debounced function
       */
      debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
              const later = () => {
                  clearTimeout(timeout);
                  func(...args);
              };
              clearTimeout(timeout);
              timeout = setTimeout(later, wait);
          };
      }

      /**
       * Delay function
       * @param {number} ms - Milliseconds to delay
       * @returns {Promise} Promise that resolves after delay
       */
      delay(ms) {
          return new Promise(resolve => setTimeout(resolve, ms));
      }
  }
</script>

<!-- js/report.js -->
<script id="report-js" type="text/plain">
  /**
   * Report generation and management
   */
  class ReportManager {
      constructor() {
          this.storage = new StorageManager();
      }

      /**
       * Generate the report
       * @returns {boolean} Success status
       */
      generateReport() {
          const title = document.getElementById('report-title').value.trim();
          const prices = this.collectPrices();

          if (prices.length === 0) {
              return false;
          }

          this.renderReport(title, prices);
          return true;
      }

      /**
       * Collect prices from form
       * @returns {Array} Array of products with prices
       */
      collectPrices() {
          const prices = [];

          PRODUCTS.forEach(product => {
              const input = document.getElementById(`price-${this.storage.getProductId(product)}`);
              if (input && input.value && parseFloat(input.value) > 0) {
                  prices.push({
                      name: product,
                      price: parseFloat(input.value)
                  });
              }
          });

          return prices;
      }

      /**
       * Render the report
       * @param {string} title - Report title
       * @param {Array} prices - Array of products with prices
       */
      renderReport(title, prices) {
          // Set title
          const titleElement = document.getElementById('report-title-display');
          titleElement.textContent = title || 'Lista de Pre√ßos';

          // Set date
          const dateElement = document.getElementById('report-date');
          dateElement.textContent = new Date().toLocaleDateString('pt-BR', {
              weekday: 'long',
              year: 'numeric',
              month: 'long',
              day: 'numeric'
          });

          // Render products
          this.renderReportProducts(prices);
      }

      /**
       * Render products in report
       * @param {Array} prices - Array of products with prices
       */
      renderReportProducts(prices) {
          const container = document.getElementById('report-products');
          container.innerHTML = '';

          prices.forEach(item => {
              const productElement = this.createReportProductElement(item);
              container.appendChild(productElement);
          });
      }

      /**
       * Create report product element
       * @param {Object} item - Product item with name and price
       * @returns {HTMLElement} Product element
       */
      createReportProductElement(item) {
          const div = document.createElement('div');
          div.className = 'bg-white bg-opacity-10 backdrop-blur-sm rounded-lg p-4 border border-white border-opacity-20';

          div.innerHTML = `
              <div class="flex justify-between items-center">
                  <h3 class="font-medium text-white text-sm">${item.name}</h3>
                  <span class="text-xl font-bold text-white">R$ ${item.price.toFixed(2).replace('.', ',')}</span>
              </div>
          `;

          return div;
      }

      /**
       * Get report data for sharing
       * @returns {Object} Report data
       */
      getReportData() {
          const title = document.getElementById('report-title-display').textContent;
          const date = document.getElementById('report-date').textContent;
          const prices = this.collectPrices();

          return { title, date, prices };
      }
  }
</script>

<!-- js/share.js -->
<script id="share-js" type="text/plain">
  /**
   * Share functionality using Web Share API and canvas
   */
  class ShareManager {
      constructor() {
          this.setupShareButton();
      }

      /**
       * Setup share button event listener
       */
      setupShareButton() {
          document.getElementById('share-btn').addEventListener('click', () => {
              this.shareReport();
          });
      }

      /**
       * Share the report
       */
      async shareReport() {
          try {
              const ui = new UIManager();
              ui.showLoading(true);

              const reportData = new ReportManager().getReportData();

              if (navigator.share) {
                  await this.shareWithWebAPI(reportData);
              } else {
                  await this.fallbackShare(reportData);
              }

              ui.showLoading(false);
          } catch (error) {
              console.error('Error sharing:', error);
              const ui = new UIManager();
              ui.showLoading(false);
              ui.showAlert('Erro ao compartilhar. Tente novamente.');
          }
      }

      /**
       * Share using Web Share API
       * @param {Object} reportData - Report data
       */
      async shareWithWebAPI(reportData) {
          const canvas = await this.generateReportImage(reportData);

          // Convert canvas to blob
          const blob = await new Promise(resolve => {
              canvas.toBlob(resolve, 'image/png', 0.9);
          });

          const file = new File([blob], 'lista-precos.png', { type: 'image/png' });

          await navigator.share({
              title: reportData.title,
              text: `${reportData.title} - ${reportData.date}`,
              files: [file]
          });
      }

      /**
       * Fallback share method
       * @param {Object} reportData - Report data
       */
      async fallbackShare(reportData) {
          const canvas = await this.generateReportImage(reportData);

          // Create download link
          const link = document.createElement('a');
          link.download = 'lista-precos.png';
          link.href = canvas.toDataURL('image/png', 0.9);

          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
      }

      /**
       * Generate report image using canvas
       * @param {Object} reportData - Report data
       * @returns {HTMLCanvasElement} Canvas with report image
       */
      async generateReportImage(reportData) {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');

          // Set canvas size (mobile-optimized)
          canvas.width = 800;
          canvas.height = Math.max(600, reportData.prices.length * 80 + 300);

          // Create gradient background
          const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
          gradient.addColorStop(0, '#667eea');
          gradient.addColorStop(1, '#764ba2');

          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          // Draw title
          ctx.fillStyle = '#ffffff';
          ctx.font = 'bold 32px Arial';
          ctx.textAlign = 'center';
          ctx.fillText(reportData.title, canvas.width / 2, 60);

          // Draw date
          ctx.font = '18px Arial';
          ctx.fillStyle = '#e0e7ff';
          ctx.fillText(reportData.date, canvas.width / 2, 90);

          // Draw products
          let y = 150;
          ctx.textAlign = 'left';

          reportData.prices.forEach(item => {
              // Product background
              ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
              ctx.fillRect(40, y - 30, canvas.width - 80, 60);

              // Product name
              ctx.fillStyle = '#ffffff';
              ctx.font = '20px Arial';
              ctx.fillText(item.name, 60, y);

              // Product price
              ctx.font = 'bold 24px Arial';
              ctx.textAlign = 'right';
              ctx.fillText(`R$ ${item.price.toFixed(2).replace('.', ',')}`, canvas.width - 60, y);

              ctx.textAlign = 'left';
              y += 70;
          });

          return canvas;
      }
  }
</script>

<!-- js/app.js -->
<script id="app-js" type="text/plain">
  /**
   * Main application initialization
   */
  class App {
      constructor() {
          this.ui = new UIManager();
          this.share = new ShareManager();
      }

      /**
       * Initialize the application
       */
      init() {
          // Wait for DOM to be fully loaded
          if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', () => {
                  this.ui.init();
              });
          } else {
              this.ui.init();
          }
      }
  }

  // Initialize the application
  const app = new App();
  app.init();
</script>

<script>
  // Extract and inject all JavaScript files
  document.addEventListener("DOMContentLoaded", function () {
    const scripts = ["config-js", "storage-js", "ui-js", "report-js", "share-js", "app-js"];

    scripts.forEach((id) => {
      const scriptElement = document.getElementById(id);
      if (scriptElement) {
        const code = scriptElement.textContent;
        const newScript = document.createElement("script");
        newScript.textContent = code;
        document.body.appendChild(newScript);
      }
    });
  });
</script>
